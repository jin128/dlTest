<!doctype html>
<html>
<head>
<meta charset="UTF-8"> 
<meta http-equiv="content-language" content="ja"> 
<title>DL test</title>

</head>
<body>
  <h3>test ver3.12<h3>
  <div>
    <button style="width=60px; height=30px;" id='b1' type="button" onclick="a()">setAtt</button>
  </div>
  <div>
    <button style="width=60px; height=30px;" id='b2' type="button" onclick="b()">not set</button>
  </div>
  <div>
    <button style="width=60px; height=30px;" id='b3' type="button" onclick="c()">new tab</button>
  </div>
  
  <script>
    let pdfBase64Encoded = 'JVBERi0xLjMKMyAwIG9iago8PC9UeXBlIC9QYWdlCi9QYXJlbnQgMSAwIFIKL1Jlc291cmNlcyAyIDAgUgovQ29udGVudHMgNCAwIFI+PgplbmRvYmoKNCAwIG9iago8PC9MZW5ndGggMzQzPj4Kc3RyZWFtCjAuNTcgdwowIEcKcQpxIEJUIDQyLjUyIDc5OS4zNyBUZAowIC0xNC4wNCBUZAovRjIgMTQuMDQgVGYgKEdlbmVyYXRlIFBERiBmaWxlcyBpbiBjbGllbnQtc2lkZSBKYXZhU2NyaXB0KSBUagpFVCBRCnEgQlQgNDIuNTIgNzcxLjI5IFRkCjAgLTEyLjAwIFRkCi9GMSAxMi4wMCBUZiAoaHJlZj0iaHR0cHM6Ly9wYXJhbGwuYXgvcHJvZHVjdHMvanNwZGYjIikgVGoKRVQgUQpxIEJUIDQyLjUyIDc0Ny4yOSBUZAowIC0xMi4wMCBUZAovRjEgMTIuMDAgVGYgKE9yIHJlZmVyIHRvIHRoZSBZb3VUdWJlIHZpZGVvOiBodHRwczovL3d3dy55b3V0dWJlLmNvbS93YXRjaD92PUNucHJ4RF9zSkZFKSBUagpFVCBRClEKZW5kc3RyZWFtCmVuZG9iagoxIDAgb2JqCjw8L1R5cGUgL1BhZ2VzCi9LaWRzIFszIDAgUiBdCi9Db3VudCAxCi9NZWRpYUJveCBbMCAwIDU5NS4yOCA4NDEuODldCj4+CmVuZG9iago1IDAgb2JqCjw8L0Jhc2VGb250L0hlbHZldGljYS9UeXBlL0ZvbnQKL0VuY29kaW5nL1dpbkFuc2lFbmNvZGluZwovU3VidHlwZS9UeXBlMT4+CmVuZG9iago2IDAgb2JqCjw8L0Jhc2VGb250L0hlbHZldGljYS1Cb2xkL1R5cGUvRm9udAovRW5jb2RpbmcvV2luQW5zaUVuY29kaW5nCi9TdWJ0eXBlL1R5cGUxPj4KZW5kb2JqCjcgMCBvYmoKPDwvQmFzZUZvbnQvSGVsdmV0aWNhLU9ibGlxdWUvVHlwZS9Gb250Ci9FbmNvZGluZy9XaW5BbnNpRW5jb2RpbmcKL1N1YnR5cGUvVHlwZTE+PgplbmRvYmoKOCAwIG9iago8PC9CYXNlRm9udC9IZWx2ZXRpY2EtQm9sZE9ibGlxdWUvVHlwZS9Gb250Ci9FbmNvZGluZy9XaW5BbnNpRW5jb2RpbmcKL1N1YnR5cGUvVHlwZTE+PgplbmRvYmoKOSAwIG9iago8PC9CYXNlRm9udC9Db3VyaWVyL1R5cGUvRm9udAovRW5jb2RpbmcvV2luQW5zaUVuY29kaW5nCi9TdWJ0eXBlL1R5cGUxPj4KZW5kb2JqCjEwIDAgb2JqCjw8L0Jhc2VGb250L0NvdXJpZXItQm9sZC9UeXBlL0ZvbnQKL0VuY29kaW5nL1dpbkFuc2lFbmNvZGluZwovU3VidHlwZS9UeXBlMT4+CmVuZG9iagoxMSAwIG9iago8PC9CYXNlRm9udC9Db3VyaWVyLU9ibGlxdWUvVHlwZS9Gb250Ci9FbmNvZGluZy9XaW5BbnNpRW5jb2RpbmcKL1N1YnR5cGUvVHlwZTE+PgplbmRvYmoKMTIgMCBvYmoKPDwvQmFzZUZvbnQvQ291cmllci1Cb2xkT2JsaXF1ZS9UeXBlL0ZvbnQKL0VuY29kaW5nL1dpbkFuc2lFbmNvZGluZwovU3VidHlwZS9UeXBlMT4+CmVuZG9iagoxMyAwIG9iago8PC9CYXNlRm9udC9UaW1lcy1Sb21hbi9UeXBlL0ZvbnQKL0VuY29kaW5nL1dpbkFuc2lFbmNvZGluZwovU3VidHlwZS9UeXBlMT4+CmVuZG9iagoxNCAwIG9iago8PC9CYXNlRm9udC9UaW1lcy1Cb2xkL1R5cGUvRm9udAovRW5jb2RpbmcvV2luQW5zaUVuY29kaW5nCi9TdWJ0eXBlL1R5cGUxPj4KZW5kb2JqCjE1IDAgb2JqCjw8L0Jhc2VGb250L1RpbWVzLUl0YWxpYy9UeXBlL0ZvbnQKL0VuY29kaW5nL1dpbkFuc2lFbmNvZGluZwovU3VidHlwZS9UeXBlMT4+CmVuZG9iagoxNiAwIG9iago8PC9CYXNlRm9udC9UaW1lcy1Cb2xkSXRhbGljL1R5cGUvRm9udAovRW5jb2RpbmcvV2luQW5zaUVuY29kaW5nCi9TdWJ0eXBlL1R5cGUxPj4KZW5kb2JqCjIgMCBvYmoKPDwKL1Byb2NTZXQgWy9QREYgL1RleHQgL0ltYWdlQiAvSW1hZ2VDIC9JbWFnZUldCi9Gb250IDw8Ci9GMSA1IDAgUgovRjIgNiAwIFIKL0YzIDcgMCBSCi9GNCA4IDAgUgovRjUgOSAwIFIKL0Y2IDEwIDAgUgovRjcgMTEgMCBSCi9GOCAxMiAwIFIKL0Y5IDEzIDAgUgovRjEwIDE0IDAgUgovRjExIDE1IDAgUgovRjEyIDE2IDAgUgo+PgovWE9iamVjdCA8PAo+Pgo+PgplbmRvYmoKMTcgMCBvYmoKPDwKL1Byb2R1Y2VyIChqc1BERiAyMDEyMDYxOSkKL0NyZWF0aW9uRGF0ZSAoRDoyMDIyMDkyMDIwMjgxOSkKPj4KZW5kb2JqCjE4IDAgb2JqCjw8Ci9UeXBlIC9DYXRhbG9nCi9QYWdlcyAxIDAgUgovT3BlbkFjdGlvbiBbMyAwIFIgL0ZpdEggbnVsbF0KL1BhZ2VMYXlvdXQgL09uZUNvbHVtbgo+PgplbmRvYmoKeHJlZgowIDE5CjAwMDAwMDAwMDAgNjU1MzUgZiAKMDAwMDAwMDQ3OSAwMDAwMCBuIAowMDAwMDAxNzA4IDAwMDAwIG4gCjAwMDAwMDAwMDkgMDAwMDAgbiAKMDAwMDAwMDA4NyAwMDAwMCBuIAowMDAwMDAwNTY2IDAwMDAwIG4gCjAwMDAwMDA2NTYgMDAwMDAgbiAKMDAwMDAwMDc1MSAwMDAwMCBuIAowMDAwMDAwODQ5IDAwMDAwIG4gCjAwMDAwMDA5NTEgMDAwMDAgbiAKMDAwMDAwMTAzOSAwMDAwMCBuIAowMDAwMDAxMTMzIDAwMDAwIG4gCjAwMDAwMDEyMzAgMDAwMDAgbiAKMDAwMDAwMTMzMSAwMDAwMCBuIAowMDAwMDAxNDI0IDAwMDAwIG4gCjAwMDAwMDE1MTYgMDAwMDAgbiAKMDAwMDAwMTYxMCAwMDAwMCBuIAowMDAwMDAxOTMyIDAwMDAwIG4gCjAwMDAwMDIwMTQgMDAwMDAgbiAKdHJhaWxlcgo8PAovU2l6ZSAxOQovUm9vdCAxOCAwIFIKL0luZm8gMTcgMCBSCj4+CnN0YXJ0eHJlZgoyMTE4CiUlRU9G';

function a() {
      // const blob = new Blob(['hoge'], { type: 'text/plain'});
      let bin = atob(pdfBase64Encoded.replace(/^.*,/,''))
      var buffer = new Uint8Array(bin.length)
      
      for (let i = 0; i < bin.length; i++) {
        buffer[i] = bin.charCodeAt(i)
      }
  
      const blob = new Blob([buffer.buffer], {type: 'application/pdf'})
      let file = new File([blob], 'test.pdf', {type: 'application'})
  
      let aEl = document.createElement('a');
      aEl.href = window.URL.createObjectURL(file);
      //aEl.download = 'test.txt';
      aEl.download = 'test1.pdf';
      
      document.body.appendChild(aEl);
      aEl.click();
      document.body.removeChild(aEl);
    }

    function b() {
      // const blob = new Blob(['hoge'], { type: 'text/plain'});
      let bin = atob(pdfBase64Encoded.replace(/^.*,/,''))
      var buffer = new Uint8Array(bin.length)
      
      for (let i = 0; i < bin.length; i++) {
        buffer[i] = bin.charCodeAt(i)
      }
  
      const blob = new Blob([buffer.buffer], {type: 'application/pdf'})
      let file = new File([blob], 'test.pdf', {type: 'application'})
      
      let aEl = document.createElement('a');
      aEl.href = window.URL.createObjectURL(blob);
      //aEl.setAttribute('download', 'test2.txt')
      aEl.download = 'test1.pdf';
      aEl.setAttribute('download', 'test2.pdf')
  
      document.body.appendChild(aEl);
      aEl.click();
      document.body.removeChild(aEl);
    }  
    
    function c() {
      // const blob = new Blob(['hoge'], { type: 'text/plain'});
      let bin = atob(pdfBase64Encoded.replace(/^.*,/,''))
      var buffer = new Uint8Array(bin.length)
      
      for (let i = 0; i < bin.length; i++) {
        buffer[i] = bin.charCodeAt(i)
      }
  
      const blob = new Blob([buffer.buffer], {type: 'application/pdf'})
      let file = new File([blob], 'test.pdf', {type: 'application'})
      
      let aEl = document.createElement('a');
      aEl.href = window.URL.createObjectURL(blob);
      
      let ua = window.navigator.userAgent.toLowerCase(); 
      let isIOs = ua.match(/iphone/i) || ua.match(/ipad/i)
      let isSafari = ua.match(/safari/i) && !ua.match(/crios/i)
      //if (isSafari && isIOs) {
        //aEl.target = '_blank';
        //aEl.rel = 'noopener noreferrer';
      //} else {
       // aEl.setAttribute('download', 'test3.pdf');
      //}
  
      document.body.appendChild(aEl);
      aEl.click();
      document.body.removeChild(aEl);
    }  
  </script>
</body>
</html>
