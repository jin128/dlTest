<!doctype html>
<html>
<head>
<meta charset="UTF-8"> 
<meta http-equiv="content-language" content="ja"> 
<title>DL test</title>

</head>
<body>
  <h3>test ver3.8<h3>
  <div>
    <button style="width=60px; height=30px;" id='b1' type="button" onclick="a()">setAtt</button>
  </div>
  <div>
    <button style="width=60px; height=30px;" id='b2' type="button" onclick="b()">not set</button>
  </div>
  <div>
    <button style="width=60px; height=30px;" id='b3' type="button" onclick="c()">new tab</button>
  </div>
  
  <script>
    function a() {
      //alert(1);
      const blob = new Blob(['hoge', { type: 'text/plain'}]);
      let aEl = document.createElement('a');
      aEl.href = window.URL.createObjectURL(blob);
  
      aEl.download = 'test.txt';
      
      document.body.appendChild(aEl);
  
      aEl.click();
  
      document.body.removeChild(aEl);
    }

    function b() {
      //alert(2);
      const blob = new Blob(['hoge', { type: 'text/plain'}]);
      let aEl = document.createElement('a');
      aEl.href = window.URL.createObjectURL(blob);
  
      aEl.setAttribute('download', 'test2.txt')
  
      document.body.appendChild(aEl);
  
      aEl.click();
  
      document.body.removeChild(aEl);
    }  
    
    function c() {
      //alert(2);
      const blob = new Blob(['hoge', { type: 'text/plain'}]);
      let aEl = document.createElement('a');
      //alert(1)
      aEl.href = window.URL.createObjectURL(blob);
      //alert(2)
      
      
      let ua = window.navigator.userAgent.toLowerCase();
      //alert(ua)
      if (ua.match(/iphone/i)) {
       alert('not sp");
       aEl.setAttribute('download', 'test2.txt');
      } else {
        if (ua.match(/safari/i)  && !ua.imatch(/crios/i)) {
          alert('safari')
          aEl.target = '_blank';
          aEl.rel = 'noopener noreferrer';
        } else {
          alert('not safari')
          aEl.setAttribute('download', 'test2.txt');
        }
      }
      
  
      alert(5)
      document.body.appendChild(aEl);
  
      alert(6)
      aEl.click();
  
      alert(7)
      document.body.removeChild(aEl);
      alert(8)
    }  
  </script>
</body>
</html>
